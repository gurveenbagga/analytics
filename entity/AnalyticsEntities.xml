<?xml version="1.0" encoding="UTF-8"?>
<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/entity-definition-2.1.xsd">

    <entity entity-name="DateDimension" package="mantle.analytics.dimension" group="analytical">
        <description>Date (days) dimension. The natural key is [dateValue]</description>
        <field name="dimensionId" type="id" is-pk="true">
            <description>Unique identifier of the Date dimension record</description>
        </field>
        <field name="dateValue" type="date">
            <description>The date (day)</description>
        </field>
        <field name="description" type="text-long">
            <description>Full date description</description>
        </field>
        <field name="dayName" type="text-medium">
            <description>The name of the day (Monday, Tuesday, etc...)</description>
        </field>
        <field name="dayOfMonth" type="number-integer">
            <description>The number of the day in the month</description>
        </field>
        <field name="dayOfYear" type="number-integer">
            <description>The number of the day in the year</description>
        </field>
        <field name="monthName" type="text-medium">
            <description>The name of the month (January, February, etc...)</description>
        </field>
        <field name="monthOfYear" type="number-integer">
            <description>The number of the month (1-12)</description>
        </field>
        <field name="yearName" type="number-integer">
            <description>The year (2008, 2009, etc...)</description>
        </field>
        <field name="weekOfMonth" type="number-integer">
            <description>The number of the week in the month</description>
        </field>
        <field name="weekOfYear" type="number-integer">
            <description>The number of the week in the year</description>
        </field>
        <field name="yearMonthDay" type="text-medium">
            <description>YYYY-MM-DD</description>
        </field>
        <field name="yearAndMonth" type="text-medium">
            <description>YYYY-MM</description>
        </field>
        <field name="weekdayType" type="text-medium">
            <description>Weekday indicator (Weekday or Weekend)</description>
        </field>
    </entity>

    <entity entity-name="CurrencyDimension" package="mantle.analytics.dimension" group="analytical">
        <description>Currency dimension. The natural key is [currencyId]</description>
        <field name="dimensionId" type="id" is-pk="true">
            <description>Unique identifier of the Currency dimension record</description>
        </field>
        <field name="currencyId" type="id">
            <description>The currency id (natural key).</description>
        </field>
        <field name="description" type="text-long">
            <description>Full currency description</description>
        </field>
    </entity>

    <entity entity-name="ProductDimension" package="mantle.analytics.dimension.product" group="analytical">
        <description>Product dimension. The natural key is [productId]</description>
        <field name="dimensionId" type="id" is-pk="true">
            <description>Unique identifier of the Product dimension record</description>
        </field>
        <field name="productId" type="id">
            <description>The natural key. From Product.productId</description>
        </field>
        <field name="productType" type="text-long">
            <description>The product type. From ProductType.description</description>
        </field>
        <field name="brandName" type="text-medium"/>
        <field name="internalName" type="text-long"/>
    </entity>

    <entity entity-name="SalesInvoiceItemFact" package="mantle.analytics.fact.accounting" group="analytical">
        <description>A transaction fact entity with invoice item grain.</description>
        <field name="invoiceId" type="id" is-pk="true"/>
        <field name="invoiceItemSeqId" type="id" is-pk="true"/>
        <field name="orderId" type="id"/>
        <field name="invoiceDateDimId" type="id"/>
        <field name="productDimId" type="id"/>
        <field name="billToCustomerDimId" type="id"/>
        <field name="origCurrencyDimId" type="id"/>
        <field name="quantity" type="number-decimal">
            <description>Quantity invoiced. From InvoiceItem.quantity</description>
        </field>
        <field name="extGrossAmount" type="currency-precise">
            <description>Extended gross amount: quantity invoiced multiplied by the list unit price.</description>
        </field>
        <field name="extDiscountAmount" type="currency-precise">
            <description>Extended discount amount.</description>
        </field>
        <field name="extNetAmount" type="currency-precise">
            <description>Extended net amount: gross amount less discounts.</description>
        </field>
        <field name="extTaxAmount" type="currency-precise">
            <description>Extended tax amount.</description>
        </field>
        <field name="extManFixedCost" type="currency-precise">
            <description>Extended manufacturing fixed cost.</description>
        </field>
        <field name="extManVarCost" type="currency-precise">
            <description>Extended manufacturing variable cost.</description>
        </field>
        <field name="extStorageCost" type="currency-precise">
            <description>Extended storage cost.</description>
        </field>
        <field name="extDistributionCost" type="currency-precise">
            <description>Extended distribution cost.</description>
        </field>
        <field name="contributionAmount" type="currency-precise">
            <description>Extended net amount less all the costs.</description>
        </field>
        <relationship type="one" fk-name="SIIF_INVDATE" related="DateDimension">
            <key-map field-name="invoiceDateDimId" related="dimensionId"/>
        </relationship>
        <relationship type="one" fk-name="SIIF_CURRENCY" related="CurrencyDimension">
            <key-map field-name="origCurrencyDimId" related="dimensionId"/>
        </relationship>
        <relationship type="one" fk-name="SIIF_PRODUCT" related="ProductDimension">
            <key-map field-name="productDimId" related="dimensionId"/>
        </relationship>
    </entity>

    <entity entity-name="SalesOrderItemFact" package="mantle.analytics.fact.order" group="analytical">
        <description>A transaction fact entity with order item grain.</description>
        <field name="orderId" type="id" is-pk="true"/>
        <field name="orderItemSeqId" type="id" is-pk="true"/>
        <field name="orderDateDimId" type="id"/>
        <field name="productDimId" type="id"/>
        <field name="origCurrencyDimId" type="id"/>
        <field name="billToCustomerDimId" type="id"/>
        <field name="productCategoryId" type="id"/>
        <field name="productStoreId" type="id"/>
        <field name="salesChannelEnumId" type="id"/>
        <field name="statusId" type="id"/>
        <field name="brand" type="text-medium"/>
        <field name="pod" type="text-medium"/>
        <field name="account" type="text-medium"/>
        <field name="quantity" type="number-decimal">
            <description>Quantity order. From OrderItem.quantity</description>
        </field>
        <field name="extGrossAmount" type="currency-precise">
            <description>Extended gross amount: quantity item multiplied by the unit price.</description>
        </field>
        <field name="extGrossCost" type="currency-precise">
            <description>Extended gross cost: quantity item multiplied by the last price.</description>
        </field>
        <field name="extDiscountAmount" type="currency-precise">
            <description>Extended discount amount.</description>
        </field>
        <field name="extNetAmount" type="currency-precise">
            <description>Extended net amount: gross amount less discounts.</description>
        </field>
        <field name="extShippingAmount" type="currency-precise">
            <description>Extended shipping amount.</description>
        </field>
        <field name="extTaxAmount" type="currency-precise">
            <description>Extended tax amount.</description>
        </field>
        <!-- TODO resolve the warnings for the column names, for now used as is from OFBiz  -->
        <field name="GS" type="currency-precise">
            <description>Gross Sales: Gross Amount plus Shipping Amount.</description>
        </field>
        <field name="GMS" type="currency-precise">
            <description>Gross Merchandize Sales: Gross Amount.</description>
        </field>
        <field name="GMP" type="currency-precise">
            <description>Gross Merchandize Profit: Gross Merchandize Sales less Gross Cost.</description>
        </field>
        <field name="GSS" type="currency-precise">
            <description>Gross Shipping Sales: Shipping Amount</description>
        </field>
        <field name="GSC" type="currency-precise">
            <description>Gross Shipping Cost</description>
        </field>
        <field name="GSP" type="currency-precise">
            <description>Gross Shipping Profit: Gross Shipping Sales less Gross Shipping Cost.</description>
        </field>
        <field name="GP" type="currency-precise">
            <description>Gross Profit: Gross Merchandize Profit less Gross Shipping Profit.</description>
        </field>
        <field name="countOrder" type="number-decimal">
            <description>Count of order.</description>
        </field>
        <field name="productPromoCode" type="id">
            <description>Product promotion Code.</description>
        </field>
        <relationship type="one" fk-name="SOIF_ORDERDATE" related="DateDimension">
            <key-map field-name="orderDateDimId" related="dimensionId"/>
        </relationship>
        <relationship type="one" fk-name="SOIF_CURRENCY" related="CurrencyDimension">
            <key-map field-name="origCurrencyDimId" related="dimensionId"/>
        </relationship>
        <relationship type="one" fk-name="SOIF_PRODUCT" related="ProductDimension">
            <key-map field-name="productDimId" related="dimensionId"/>
        </relationship>
    </entity>

    <entity entity-name="InventoryItemFact" package="mantle.analytics.fact.product" group="analytical">
        <description>A transaction fact entity with inventory item.</description>
        <field name="inventoryItemId" type="id" is-pk="true"/>
        <field name="facilityId" type="id"/>
        <field name="productDimId" type="id"/>
        <field name="origCurrencyDimId" type="id"/>
        <field name="inventoryDateDimId" type="id"/>
        <field name="quantityOnHandTotal" type="number-decimal"/>
        <field name="availableToPromiseTotal" type="number-decimal"/>
        <field name="unitCost" type="number-decimal"/>
        <field name="soldoutAmount" type="number-decimal"/>
        <relationship type="one" fk-name="IIF_INVPRODUCT" related="ProductDimension">
            <key-map field-name="productDimId" related="dimensionId"/>
        </relationship>
        <relationship type="one" fk-name="IIF_INVCURRENCY" related="CurrencyDimension">
            <key-map field-name="origCurrencyDimId" related="dimensionId"/>
        </relationship>
        <relationship type="one" fk-name="IIF_INVDATE" related="DateDimension">
            <key-map field-name="inventoryDateDimId" related="dimensionId"/>
        </relationship>
    </entity>

    <entity entity-name="ShopifyOrderIdentFact" package="mantle.analytics.fact.order" group="analytical">
        <field name="orderId" type="id" is-pk="true"/>
        <field name="shopifyOrderId" type="id"/>
        <field name="shopifyOrderNumber" type="id"/>
        <field name="shopifyOrderName" type="text-medium"/>
    </entity>

    <view-entity entity-name="SalesInvoiceItemStarSchema" package="mantle.analytics.starschema.accounting">
        <description>Invoice Item star schema (Profit and Loss Statement).</description>
        <member-entity entity-alias="SIIF" entity-name="SalesInvoiceItemFact">
        </member-entity>
        <member-entity entity-alias="IDD" entity-name="DateDimension" join-from-alias="SIIF">
            <key-map field-name="invoiceDateDimId" related="dimensionId"/>
        </member-entity>
        <member-entity entity-alias="PD" entity-name="ProductDimension" join-from-alias="SIIF">
            <key-map field-name="productDimId" related="dimensionId"/>
        </member-entity>
        <member-entity entity-alias="CD" entity-name="CurrencyDimension" join-from-alias="SIIF">
            <key-map field-name="origCurrencyDimId" related="dimensionId"/>
        </member-entity>
        <alias-all entity-alias="IDD" prefix="invoiceDate">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias-all entity-alias="PD" prefix="product">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias-all entity-alias="CD" prefix="currency">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias-all entity-alias="SIIF">
            <exclude field="invoiceItemSeqId"/>
            <exclude field="invoiceDateDimId"/>
            <exclude field="productDimId"/>
            <exclude field="billToCustomerDimId"/>
            <exclude field="origCurrencyDimId"/>
            <exclude field="orderId"/>
            <exclude field="invoiceId"/>
            <exclude field="invoiceItemSeqId"/>
        </alias-all>
        <alias entity-alias="SIIF" name="invoiceId">
            <description>Invoice id</description>
        </alias>
        <alias entity-alias="SIIF" name="invoiceItemSeqId">
        </alias>
        <alias entity-alias="SIIF" name="orderId">
        </alias>
    </view-entity>

    <view-entity entity-name="SalesOrderItemStarSchema" package="mantle.analytics.starschema.order">
        <description>Order Item star schema (Profit and Loss Statement).</description>
        <member-entity entity-alias="SOIF" entity-name="SalesOrderItemFact" join-from-alias="SIIF">
            <key-map field-name="origCurrencyDimId" related="dimensionId"/>
        </member-entity>
        <member-entity entity-alias="ODD" entity-name="DateDimension" join-from-alias="SOIF">
            <key-map field-name="orderDateDimId" related="dimensionId"/>
        </member-entity>
        <member-entity entity-alias="PD" entity-name="ProductDimension" join-from-alias="SOIF">
            <key-map field-name="productDimId" related="dimensionId"/>
        </member-entity>
        <member-entity entity-alias="CD" entity-name="CurrencyDimension" join-from-alias="SOIF">
            <key-map field-name="origCurrencyDimId" related="dimensionId"/>
        </member-entity>
        <alias-all entity-alias="ODD" prefix="orderDate">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias-all entity-alias="PD" prefix="product">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias-all entity-alias="CD" prefix="currency">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias-all entity-alias="SOIF">
            <exclude field="orderId"/>
            <exclude field="orderItemSeqId"/>
            <exclude field="orderDateDimId"/>
            <exclude field="productDimId"/>
            <exclude field="origCurrencyDimId"/>
            <exclude field="billToCustomerDimId"/>
            <exclude field="productCategoryId"/>
            <exclude field="productStoreId"/>
            <exclude field="salesChannelEnumId"/>
            <exclude field="statusId"/>
            <exclude field="brand"/>
            <exclude field="pod"/>
            <exclude field="account"/>
            <exclude field="productPromoCode"/>
            <exclude field="completedDatetime"/>
        </alias-all>
        <alias entity-alias="SOIF" name="orderId">
            <description>Order id</description>
        </alias>
        <alias entity-alias="SOIF" name="productPromoCode">
        </alias>
        <alias entity-alias="SOIF" name="orderItemSeqId">
        </alias>
        <alias entity-alias="SOIF" name="productCategoryId">
        </alias>
        <alias entity-alias="SOIF" name="productStoreId">
        </alias>
        <alias entity-alias="SOIF" name="salesChannelEnumId">
        </alias>
        <alias entity-alias="SOIF" name="statusId">
        </alias>
        <alias entity-alias="SOIF" name="brand">
        </alias>
        <alias entity-alias="SOIF" name="pod">
        </alias>
        <alias entity-alias="SOIF" name="account">
        </alias>
        <alias entity-alias="SOIF" name="completedDatetime">
        </alias>
    </view-entity>

    <view-entity entity-name="InventoryItemSchema" package="mantle.analytics.starschema.product">
        <description>"Inventory Item Schema.</description>
        <member-entity entity-alias="IIF" entity-name="InventoryItemFact" join-from-alias="SOIF">
            <key-map field-name="origCurrencyDimId" related="dimensionId"/>
        </member-entity>
        <member-entity entity-alias="PD" entity-name="ProductDimension" join-from-alias="IIF" join-optional="true">
            <key-map field-name="productDimId" related="dimensionId"/>
        </member-entity>
        <member-entity entity-alias="IDD" entity-name="DateDimension" join-from-alias="IIF">
            <key-map field-name="inventoryDateDimId" related="dimensionId"/>
        </member-entity>
        <member-entity entity-alias="CD" entity-name="CurrencyDimension" join-from-alias="IIF">
            <key-map field-name="origCurrencyDimId" related="dimensionId"/>
        </member-entity>
        <alias-all entity-alias="IIF">
            <exclude field="inventoryItemId"/>
            <exclude field="orderId"/>
            <exclude field="facilityId"/>
            <exclude field="inventoryDateDimId"/>
            <exclude field="productDimId"/>
            <exclude field="origCurrencyDimId"/>
        </alias-all>
        <alias-all entity-alias="PD" prefix="product">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias-all entity-alias="IDD" prefix="inventoryDate">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias-all entity-alias="CD" prefix="currency">
            <exclude field="dimensionId"/>
        </alias-all>
        <alias entity-alias="IIF" name="inventoryItemId">
            <description>Inventory Item Id</description>
        </alias>
        <alias entity-alias="IIF" name="facilityId">
            <description>Facility Id</description>
        </alias>
        <alias entity-alias="PD" name="productId">
            <description>Product id</description>
        </alias>
    </view-entity>
</entities>

